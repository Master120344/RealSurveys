<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surveys</title>
    <link rel="stylesheet" href="balance.css">
    <style>
        /* Existing styles */
        /* Add or modify styles for the balance display if needed */
        #user-balance {
            font-size: 18px;
            margin-top: 10px;
        }
    </style>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-auth.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA7GP-4bnijUNXGBti2nCOJF9iwusuL7c4",
            authDomain: "real-surveys.firebaseapp.com",
            databaseURL: "https://real-surveys-default-rtdb.firebaseio.com",
            projectId: "real-surveys",
            storageBucket: "real-surveys.appspot.com",
            messagingSenderId: "1024139519354",
            appId: "1:1024139519354:web:a0b11a5a0560ab02ee22c3"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Function to populate surveys
        function populateSurveys() {
            const surveysRef = ref(database, 'surveys');
            onValue(surveysRef, (snapshot) => {
                const surveys = snapshot.val();
                const surveyContainer = document.querySelector('.survey-container');
                surveyContainer.innerHTML = ''; // Clear existing surveys

                for (const [key, survey] of Object.entries(surveys)) {
                    const surveyCard = document.createElement('div');
                    surveyCard.className = 'survey-card';
                    surveyCard.style.backgroundImage = `url('https://example.com/${key}.jpg')`; // Placeholder image URL
                    surveyCard.innerHTML = `
                        <h2>${survey.title}</h2>
                        <p>Reward: $${survey.reward}</p>
                        <a href="${survey.link}">Start Survey</a>
                    `;
                    surveyContainer.appendChild(surveyCard);
                }
            });
        }

        // Check if user is logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Display user email
                document.getElementById('user-email').textContent = `Logged in as: ${user.email}`;

                // Fetch and display user balance
                const userId = user.uid;
                const balanceRef = ref(database, 'users/' + userId + '/balance');
                
                onValue(balanceRef, (snapshot) => {
                    const balance = snapshot.val();
                    document.getElementById('user-balance').textContent = `Balance: $${balance}`;
                });

                // Populate surveys
                populateSurveys();
            } else {
                // If the user is not logged in, redirect to login page
                window.location.href = 'login.html';
            }
        });

        // Logout function
        function logout() {
            signOut(auth).then(() => {
                window.location.href = 'login.html';
            }).catch((error) => {
                console.error('Sign Out Error', error);
            });
        }
    </script>
</head>

<body>

    <!-- Navigation Tabs -->
    <ul class="nav-tabs">
        <li><a href="contact.html">Contact</a></li>
        <li><a href="balance.html">Balance</a></li>
        <li><a href="surveys.html">Surveys</a></li>
        <li><a href="#" onclick="logout()" aria-label="Logout">Logout</a></li>
    </ul>

    <h1>Available Surveys</h1>

    <!-- User Information -->
    <p id="user-email">Loading...</p>
    <p id="user-balance">Balance: Loading...</p>

    <!-- Survey Container -->
    <div class="survey-container">
        <!-- Survey Cards will be populated here -->
    </div>

    <!-- Pagination -->
    <div class="pagination">
        <a href="surveys.html" class="active">1</a>
        <a href="surveys2.html">2</a>
        <a href="surveys2.html">Next &raquo;</a>
    </div>

</body>

</html>
